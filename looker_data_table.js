!function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t,a){var s={};!function(e){function t(e){for(var t="",a=e.length-1;a>=0;)t+=e.charAt(a--);return t}function a(e,t){for(var a="";a.length<t;)a+=e;return a}function s(e,t){var s=""+e;return s.length>=t?s:a("0",t-s.length)+s}function r(e,t){var s=""+e;return s.length>=t?s:a(" ",t-s.length)+s}function i(e,t){var s=""+e;return s.length>=t?s:s+a(" ",t-s.length)}e.version="0.11.0";var n=Math.pow(2,32);function l(e,t){return e>n||e<-n?function(e,t){var s=""+Math.round(e);return s.length>=t?s:a("0",t-s.length)+s}(e,t):function(e,t){var s=""+e;return s.length>=t?s:a("0",t-s.length)+s}(Math.round(e),t)}function o(e,t){return t=t||0,e.length>=7+t&&103==(32|e.charCodeAt(t))&&101==(32|e.charCodeAt(t+1))&&110==(32|e.charCodeAt(t+2))&&101==(32|e.charCodeAt(t+3))&&114==(32|e.charCodeAt(t+4))&&97==(32|e.charCodeAt(t+5))&&108==(32|e.charCodeAt(t+6))}var h=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],u=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function c(e){e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e[65535]="General"}var d={};function f(e,t,a){for(var s=e<0?-1:1,r=e*s,i=0,n=1,l=0,o=1,h=0,u=0,c=Math.floor(r);h<t&&(l=(c=Math.floor(r))*n+i,u=c*h+o,!(r-c<5e-8));)r=1/(r-c),i=n,n=l,o=h,h=u;if(u>t&&(h>t?(u=o,l=i):(u=h,l=n)),!a)return[0,s*l,u];var d=Math.floor(s*l/u);return[d,s*l-d*u,u]}function v(e,t,a){if(e>2958465||e<0)return null;var s=0|e,r=Math.floor(86400*(e-s)),i=0,n=[],l={D:s,T:r,u:86400*(e-s)-r,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),t&&t.date1904&&(s+=1462),l.u>.9999&&(l.u=0,86400==++r&&(l.T=r=0,++s,++l.D)),60===s)n=a?[1317,10,29]:[1900,2,29],i=3;else if(0===s)n=a?[1317,8,29]:[1900,1,0],i=6;else{s>60&&--s;var o=new Date(1900,0,1);o.setDate(o.getDate()+s-1),n=[o.getFullYear(),o.getMonth()+1,o.getDate()],i=o.getDay(),s<60&&(i=(i+6)%7),a&&(i=0)}return l.y=n[0],l.m=n[1],l.d=n[2],l.S=r%60,r=Math.floor(r/60),l.M=r%60,r=Math.floor(r/60),l.H=r,l.q=i,l}c(d),e.parse_date_code=v;var m=new Date(1899,11,31,0,0,0),p=m.getTime(),g=new Date(1900,2,1,0,0,0);function _(e,t){var a=e.getTime();return t?a-=1262304e5:e>=g&&(a+=864e5),(a-(p+6e4*(e.getTimezoneOffset()-m.getTimezoneOffset())))/864e5}e._general_int=function(e){return e.toString(10)};var b=function(){var e=/\.(\d*[1-9])0+$/,t=/\.0*$/,a=/\.(\d*[1-9])0+/,s=/\.0*[Ee]/,r=/(E[+-])(\d)$/;function i(a){return a.indexOf(".")>-1?a.replace(t,"").replace(e,".$1"):a}return function(t){var n,l=Math.floor(Math.log(Math.abs(t))*Math.LOG10E);return n=l>=-4&&l<=-1?t.toPrecision(10+l):Math.abs(l)<=9?function(e){var t=e<0?12:11,a=i(e.toFixed(12));return a.length<=t||(a=e.toPrecision(10)).length<=t?a:e.toExponential(5)}(t):10===l?t.toFixed(10).substr(0,12):function(t){var a=t.toFixed(11).replace(e,".$1");return a.length>(t<0?12:11)&&(a=t.toPrecision(6)),a}(t),i(function(e){for(var t=0;t!=e.length;++t)if(101==(32|e.charCodeAt(t)))return e.replace(a,".$1").replace(s,"E").replace("e","E").replace(r,"$10$2");return e}(n))}}();function y(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):b(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return T(14,_(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function $(e,t,a,r){var i,n="",l=0,o=0,c=a.y,d=0;switch(e){case 98:c=a.y+543;case 121:switch(t.length){case 1:case 2:i=c%100,d=2;break;default:i=c%1e4,d=4}break;case 109:switch(t.length){case 1:case 2:i=a.m,d=t.length;break;case 3:return u[a.m-1][1];case 5:return u[a.m-1][0];default:return u[a.m-1][2]}break;case 100:switch(t.length){case 1:case 2:i=a.d,d=t.length;break;case 3:return h[a.q][0];default:return h[a.q][1]}break;case 104:switch(t.length){case 1:case 2:i=1+(a.H+11)%12,d=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:i=a.H,d=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:i=a.M,d=t.length;break;default:throw"bad minute format: "+t}break;case 115:if("s"!=t&&"ss"!=t&&".0"!=t&&".00"!=t&&".000"!=t)throw"bad second format: "+t;return 0!==a.u||"s"!=t&&"ss"!=t?(o=r>=2?3===r?1e3:100:1===r?10:1,(l=Math.round(o*(a.S+a.u)))>=60*o&&(l=0),"s"===t?0===l?"0":""+l/o:(n=s(l,2+r),"ss"===t?n.substr(0,2):"."+n.substr(2,t.length-1))):s(a.S,t.length);case 90:switch(t){case"[h]":case"[hh]":i=24*a.D+a.H;break;case"[m]":case"[mm]":i=60*(24*a.D+a.H)+a.M;break;case"[s]":case"[ss]":i=60*(60*(24*a.D+a.H)+a.M)+Math.round(a.S+a.u);break;default:throw"bad abstime format: "+t}d=3===t.length?1:2;break;case 101:i=c,d=1}return d>0?s(i,d):""}function k(e){if(e.length<=3)return e;for(var t=e.length%3,a=e.substr(0,t);t!=e.length;t+=3)a+=(a.length>0?",":"")+e.substr(t,3);return a}e._general_num=b,e._general=y;var w=function(){var e=/%/g;var n=/# (\?+)( ?)\/( ?)(\d+)/;var o=/^#*0*\.([0#]+)/,h=/\).*[0#]/,u=/\(###\) ###\\?-####/;function c(e){for(var t,a="",s=0;s!=e.length;++s)switch(t=e.charCodeAt(s)){case 35:break;case 63:a+=" ";break;case 48:a+="0";break;default:a+=String.fromCharCode(t)}return a}function d(e,t){var a=Math.pow(10,t);return""+Math.round(e*a)/a}function v(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?0:Math.round((e-Math.floor(e))*Math.pow(10,t))}function m(p,g,_){if(40===p.charCodeAt(0)&&!g.match(h)){var b=g.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return _>=0?m("n",b,_):"("+m("n",b,-_)+")"}if(44===g.charCodeAt(g.length-1))return function(e,t,a){for(var s=t.length-1;44===t.charCodeAt(s-1);)--s;return w(e,t.substr(0,s),a/Math.pow(10,3*(t.length-s)))}(p,g,_);if(-1!==g.indexOf("%"))return function(t,s,r){var i=s.replace(e,""),n=s.length-i.length;return w(t,i,r*Math.pow(10,2*n))+a("%",n)}(p,g,_);if(-1!==g.indexOf("E"))return function e(t,a){var s,r=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(0==a)return"0.0E+0";if(a<0)return"-"+e(t,-a);var i=t.indexOf(".");-1===i&&(i=t.indexOf("E"));var n=Math.floor(Math.log(a)*Math.LOG10E)%i;if(n<0&&(n+=i),-1===(s=(a/Math.pow(10,n)).toPrecision(r+1+(i+n)%i)).indexOf("e")){var l=Math.floor(Math.log(a)*Math.LOG10E);for(-1===s.indexOf(".")?s=s.charAt(0)+"."+s.substr(1)+"E+"+(l-s.length+n):s+="E+"+(l-n);"0."===s.substr(0,2);)s=(s=s.charAt(0)+s.substr(2,i)+"."+s.substr(2+i)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");s=s.replace(/\+-/,"-")}s=s.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,a,s){return t+a+s.substr(0,(i+n)%i)+"."+s.substr(n)+"E"}))}else s=a.toExponential(r);return t.match(/E\+00$/)&&s.match(/e[+-]\d$/)&&(s=s.substr(0,s.length-1)+"0"+s.charAt(s.length-1)),t.match(/E\-/)&&s.match(/e\+/)&&(s=s.replace(/e\+/,"e")),s.replace("e","E")}(g,_);if(36===g.charCodeAt(0))return"$"+m(p,g.substr(" "==g.charAt(1)?2:1),_);var y,$,M,x,A=Math.abs(_),C=_<0?"-":"";if(g.match(/^00+$/))return C+l(A,g.length);if(g.match(/^[#?]+$/))return"0"===(y=l(_,0))&&(y=""),y.length>g.length?y:c(g.substr(0,g.length-y.length))+y;if($=g.match(n))return function(e,t,i){var n=parseInt(e[4],10),l=Math.round(t*n),o=Math.floor(l/n),h=l-o*n,u=n;return i+(0===o?"":""+o)+" "+(0===h?a(" ",e[1].length+1+e[4].length):r(h,e[1].length)+e[2]+"/"+e[3]+s(u,e[4].length))}($,A,C);if(g.match(/^#+0+$/))return C+l(A,g.length-g.indexOf("0"));if($=g.match(o))return y=d(_,$[1].length).replace(/^([^\.]+)$/,"$1."+c($[1])).replace(/\.$/,"."+c($[1])).replace(/\.(\d*)$/,(function(e,t){return"."+t+a("0",c($[1]).length-t.length)})),-1!==g.indexOf("0.")?y:y.replace(/^0\./,".");if(g=g.replace(/^#+([0.])/,"$1"),$=g.match(/^(0*)\.(#*)$/))return C+d(A,$[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,$[1].length?"0.":".");if($=g.match(/^#{1,3},##0(\.?)$/))return C+k(l(A,0));if($=g.match(/^#,##0\.([#0]*0)$/))return _<0?"-"+m(p,g,-_):k(""+(Math.floor(_)+function(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}(_,$[1].length)))+"."+s(v(_,$[1].length),$[1].length);if($=g.match(/^#,#*,#0/))return m(p,g.replace(/^#,#*,/,""),_);if($=g.match(/^([0#]+)(\\?-([0#]+))+$/))return y=t(m(p,g.replace(/[\\-]/g,""),_)),M=0,t(t(g.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return M<y.length?y.charAt(M++):"0"===e?"0":""})));if(g.match(u))return"("+(y=m(p,"##########",_)).substr(0,3)+") "+y.substr(3,3)+"-"+y.substr(6);var S="";if($=g.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return M=Math.min($[4].length,7),x=f(A,Math.pow(10,M)-1,!1),y=""+C," "==(S=w("n",$[1],x[1])).charAt(S.length-1)&&(S=S.substr(0,S.length-1)+"0"),y+=S+$[2]+"/"+$[3],(S=i(x[2],M)).length<$[4].length&&(S=c($[4].substr($[4].length-S.length))+S),y+=S;if($=g.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return M=Math.min(Math.max($[1].length,$[4].length),7),C+((x=f(A,Math.pow(10,M)-1,!0))[0]||(x[1]?"":"0"))+" "+(x[1]?r(x[1],M)+$[2]+"/"+$[3]+i(x[2],M):a(" ",2*M+1+$[2].length+$[3].length));if($=g.match(/^[#0?]+$/))return y=l(_,0),g.length<=y.length?y:c(g.substr(0,g.length-y.length))+y;if($=g.match(/^([#0?]+)\.([#0]+)$/)){y=""+_.toFixed(Math.min($[2].length,10)).replace(/([^0])0+$/,"$1"),M=y.indexOf(".");var O=g.indexOf(".")-M,E=g.length-y.length-O;return c(g.substr(0,O)+y+g.substr(g.length-E))}if($=g.match(/^00,000\.([#0]*0)$/))return M=v(_,$[1].length),_<0?"-"+m(p,g,-_):k(function(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(_)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?s(0,3-e.length):"")+e}))+"."+s(M,$[1].length);switch(g){case"###,##0.00":return m(p,"#,##0.00",_);case"###,###":case"##,###":case"#,###":var T=k(l(A,0));return"0"!==T?C+T:"";case"###,###.00":return m(p,"###,##0.00",_).replace(/^0\./,".");case"#,###.00":return m(p,"#,##0.00",_).replace(/^0\./,".")}throw new Error("unsupported format |"+g+"|")}function p(l,d,v){if(40===l.charCodeAt(0)&&!d.match(h)){var m=d.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return v>=0?p("n",m,v):"("+p("n",m,-v)+")"}if(44===d.charCodeAt(d.length-1))return function(e,t,a){for(var s=t.length-1;44===t.charCodeAt(s-1);)--s;return w(e,t.substr(0,s),a/Math.pow(10,3*(t.length-s)))}(l,d,v);if(-1!==d.indexOf("%"))return function(t,s,r){var i=s.replace(e,""),n=s.length-i.length;return w(t,i,r*Math.pow(10,2*n))+a("%",n)}(l,d,v);if(-1!==d.indexOf("E"))return function e(t,a){var s,r=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(0==a)return"0.0E+0";if(a<0)return"-"+e(t,-a);var i=t.indexOf(".");-1===i&&(i=t.indexOf("E"));var n=Math.floor(Math.log(a)*Math.LOG10E)%i;if(n<0&&(n+=i),!(s=(a/Math.pow(10,n)).toPrecision(r+1+(i+n)%i)).match(/[Ee]/)){var l=Math.floor(Math.log(a)*Math.LOG10E);-1===s.indexOf(".")?s=s.charAt(0)+"."+s.substr(1)+"E+"+(l-s.length+n):s+="E+"+(l-n),s=s.replace(/\+-/,"-")}s=s.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,a,s){return t+a+s.substr(0,(i+n)%i)+"."+s.substr(n)+"E"}))}else s=a.toExponential(r);return t.match(/E\+00$/)&&s.match(/e[+-]\d$/)&&(s=s.substr(0,s.length-1)+"0"+s.charAt(s.length-1)),t.match(/E\-/)&&s.match(/e\+/)&&(s=s.replace(/e\+/,"e")),s.replace("e","E")}(d,v);if(36===d.charCodeAt(0))return"$"+p(l,d.substr(" "==d.charAt(1)?2:1),v);var g,_,b,y,$=Math.abs(v),M=v<0?"-":"";if(d.match(/^00+$/))return M+s($,d.length);if(d.match(/^[#?]+$/))return g=""+v,0===v&&(g=""),g.length>d.length?g:c(d.substr(0,d.length-g.length))+g;if(_=d.match(n))return function(e,t,s){return s+(0===t?"":""+t)+a(" ",e[1].length+2+e[4].length)}(_,$,M);if(d.match(/^#+0+$/))return M+s($,d.length-d.indexOf("0"));if(_=d.match(o))return g=(g=(""+v).replace(/^([^\.]+)$/,"$1."+c(_[1])).replace(/\.$/,"."+c(_[1]))).replace(/\.(\d*)$/,(function(e,t){return"."+t+a("0",c(_[1]).length-t.length)})),-1!==d.indexOf("0.")?g:g.replace(/^0\./,".");if(d=d.replace(/^#+([0.])/,"$1"),_=d.match(/^(0*)\.(#*)$/))return M+(""+$).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,_[1].length?"0.":".");if(_=d.match(/^#{1,3},##0(\.?)$/))return M+k(""+$);if(_=d.match(/^#,##0\.([#0]*0)$/))return v<0?"-"+p(l,d,-v):k(""+v)+"."+a("0",_[1].length);if(_=d.match(/^#,#*,#0/))return p(l,d.replace(/^#,#*,/,""),v);if(_=d.match(/^([0#]+)(\\?-([0#]+))+$/))return g=t(p(l,d.replace(/[\\-]/g,""),v)),b=0,t(t(d.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return b<g.length?g.charAt(b++):"0"===e?"0":""})));if(d.match(u))return"("+(g=p(l,"##########",v)).substr(0,3)+") "+g.substr(3,3)+"-"+g.substr(6);var x="";if(_=d.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return b=Math.min(_[4].length,7),y=f($,Math.pow(10,b)-1,!1),g=""+M," "==(x=w("n",_[1],y[1])).charAt(x.length-1)&&(x=x.substr(0,x.length-1)+"0"),g+=x+_[2]+"/"+_[3],(x=i(y[2],b)).length<_[4].length&&(x=c(_[4].substr(_[4].length-x.length))+x),g+=x;if(_=d.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return b=Math.min(Math.max(_[1].length,_[4].length),7),M+((y=f($,Math.pow(10,b)-1,!0))[0]||(y[1]?"":"0"))+" "+(y[1]?r(y[1],b)+_[2]+"/"+_[3]+i(y[2],b):a(" ",2*b+1+_[2].length+_[3].length));if(_=d.match(/^[#0?]+$/))return g=""+v,d.length<=g.length?g:c(d.substr(0,d.length-g.length))+g;if(_=d.match(/^([#0]+)\.([#0]+)$/)){g=""+v.toFixed(Math.min(_[2].length,10)).replace(/([^0])0+$/,"$1"),b=g.indexOf(".");var A=d.indexOf(".")-b,C=d.length-g.length-A;return c(d.substr(0,A)+g+d.substr(d.length-C))}if(_=d.match(/^00,000\.([#0]*0)$/))return v<0?"-"+p(l,d,-v):k(""+v).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?s(0,3-e.length):"")+e}))+"."+s(0,_[1].length);switch(d){case"###,###":case"##,###":case"#,###":var S=k(""+$);return"0"!==S?M+S:"";default:if(d.match(/\.[0#?]*$/))return p(l,d.slice(0,d.lastIndexOf(".")),v)+c(d.slice(d.lastIndexOf(".")))}throw new Error("unsupported format |"+d+"|")}return function(e,t,a){return(0|a)===a?p(e,t,a):m(e,t,a)}}();function M(e){for(var t=[],a=!1,s=0,r=0;s<e.length;++s)switch(e.charCodeAt(s)){case 34:a=!a;break;case 95:case 42:case 92:++s;break;case 59:t[t.length]=e.substr(r,s-r),r=s+1}if(t[t.length]=e.substr(r),!0===a)throw new Error("Format |"+e+"| unterminated string ");return t}e._split=M;var x=/\[[HhMmSs]*\]/;function A(e){for(var t=0,a="",s="";t<e.length;)switch(a=e.charAt(t)){case"G":o(e,t)&&(t+=6),t++;break;case'"':for(;34!==e.charCodeAt(++t)&&t<e.length;);++t;break;case"\\":case"_":t+=2;break;case"@":++t;break;case"B":case"b":if("1"===e.charAt(t+1)||"2"===e.charAt(t+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":if("A/P"===e.substr(t,3).toUpperCase())return!0;if("AM/PM"===e.substr(t,5).toUpperCase())return!0;++t;break;case"[":for(s=a;"]"!==e.charAt(t++)&&t<e.length;)s+=e.charAt(t);if(s.match(x))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(a=e.charAt(++t))>-1||"\\"==a&&"-"==e.charAt(t+1)&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===a;);break;case"*":++t," "!=e.charAt(t)&&"*"!=e.charAt(t)||++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;case" ":default:++t}return!1}function C(e,t,a,s){for(var r,i,n,l=[],h="",u=0,c="",d="t",f="H";u<e.length;)switch(c=e.charAt(u)){case"G":if(!o(e,u))throw new Error("unrecognized character "+c+" in "+e);l[l.length]={t:"G",v:"General"},u+=7;break;case'"':for(h="";34!==(n=e.charCodeAt(++u))&&u<e.length;)h+=String.fromCharCode(n);l[l.length]={t:"t",v:h},++u;break;case"\\":var m=e.charAt(++u),p="("===m||")"===m?m:"t";l[l.length]={t:p,v:m},++u;break;case"_":l[l.length]={t:"t",v:" "},u+=2;break;case"@":l[l.length]={t:"T",v:t},++u;break;case"B":case"b":if("1"===e.charAt(u+1)||"2"===e.charAt(u+1)){if(null==r&&null==(r=v(t,a,"2"===e.charAt(u+1))))return"";l[l.length]={t:"X",v:e.substr(u,2)},d=c,u+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":c=c.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0)return"";if(null==r&&null==(r=v(t,a)))return"";for(h=c;++u<e.length&&e.charAt(u).toLowerCase()===c;)h+=c;"m"===c&&"h"===d.toLowerCase()&&(c="M"),"h"===c&&(c=f),l[l.length]={t:c,v:h},d=c;break;case"A":case"a":var g={t:c,v:c};if(null==r&&(r=v(t,a)),"A/P"===e.substr(u,3).toUpperCase()?(null!=r&&(g.v=r.H>=12?"P":"A"),g.t="T",f="h",u+=3):"AM/PM"===e.substr(u,5).toUpperCase()?(null!=r&&(g.v=r.H>=12?"PM":"AM"),g.t="T",u+=5,f="h"):(g.t="t",++u),null==r&&"T"===g.t)return"";l[l.length]=g,d=c;break;case"[":for(h=c;"]"!==e.charAt(u++)&&u<e.length;)h+=e.charAt(u);if("]"!==h.slice(-1))throw'unterminated "[" block: |'+h+"|";if(h.match(x)){if(null==r&&null==(r=v(t,a)))return"";l[l.length]={t:"Z",v:h.toLowerCase()},d=h.charAt(1)}else h.indexOf("$")>-1&&(h=(h.match(/\$([^-\[\]]*)/)||[])[1]||"$",A(e)||(l[l.length]={t:"t",v:h}));break;case".":if(null!=r){for(h=c;++u<e.length&&"0"===(c=e.charAt(u));)h+=c;l[l.length]={t:"s",v:h};break}case"0":case"#":for(h=c;++u<e.length&&"0#?.,E+-%".indexOf(c=e.charAt(u))>-1;)h+=c;l[l.length]={t:"n",v:h};break;case"?":for(h=c;e.charAt(++u)===c;)h+=c;l[l.length]={t:c,v:h},d=c;break;case"*":++u," "!=e.charAt(u)&&"*"!=e.charAt(u)||++u;break;case"(":case")":l[l.length]={t:1===s?"t":c,v:c},++u;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(h=c;u<e.length&&"0123456789".indexOf(e.charAt(++u))>-1;)h+=e.charAt(u);l[l.length]={t:"D",v:h};break;case" ":l[l.length]={t:c,v:c},++u;break;case"$":l[l.length]={t:"t",v:"$"},++u;break;default:if(-1===",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(c))throw new Error("unrecognized character "+c+" in "+e);l[l.length]={t:"t",v:c},++u}var _,b=0,k=0;for(u=l.length-1,d="t";u>=0;--u)switch(l[u].t){case"h":case"H":l[u].t=f,d="h",b<1&&(b=1);break;case"s":(_=l[u].v.match(/\.0+$/))&&(k=Math.max(k,_[0].length-1)),b<3&&(b=3);case"d":case"y":case"M":case"e":d=l[u].t;break;case"m":"s"===d&&(l[u].t="M",b<2&&(b=2));break;case"X":break;case"Z":b<1&&l[u].v.match(/[Hh]/)&&(b=1),b<2&&l[u].v.match(/[Mm]/)&&(b=2),b<3&&l[u].v.match(/[Ss]/)&&(b=3)}switch(b){case 0:break;case 1:r.u>=.5&&(r.u=0,++r.S),r.S>=60&&(r.S=0,++r.M),r.M>=60&&(r.M=0,++r.H);break;case 2:r.u>=.5&&(r.u=0,++r.S),r.S>=60&&(r.S=0,++r.M)}var M,C="";for(u=0;u<l.length;++u)switch(l[u].t){case"t":case"T":case" ":case"D":break;case"X":l[u].v="",l[u].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":l[u].v=$(l[u].t.charCodeAt(0),l[u].v,r,k),l[u].t="t";break;case"n":case"?":for(M=u+1;null!=l[M]&&("?"===(c=l[M].t)||"D"===c||(" "===c||"t"===c)&&null!=l[M+1]&&("?"===l[M+1].t||"t"===l[M+1].t&&"/"===l[M+1].v)||"("===l[u].t&&(" "===c||"n"===c||")"===c)||"t"===c&&("/"===l[M].v||" "===l[M].v&&null!=l[M+1]&&"?"==l[M+1].t));)l[u].v+=l[M].v,l[M]={v:"",t:";"},++M;C+=l[u].v,u=M-1;break;case"G":l[u].t="t",l[u].v=y(t,a)}var S,O,E="";if(C.length>0){40==C.charCodeAt(0)?(S=t<0&&45===C.charCodeAt(0)?-t:t,O=w("n",C,S)):(O=w("n",C,S=t<0&&s>1?-t:t),S<0&&l[0]&&"t"==l[0].t&&(O=O.substr(1),l[0].v="-"+l[0].v)),M=O.length-1;var T=l.length;for(u=0;u<l.length;++u)if(null!=l[u]&&"t"!=l[u].t&&l[u].v.indexOf(".")>-1){T=u;break}var D=l.length;if(T===l.length&&-1===O.indexOf("E")){for(u=l.length-1;u>=0;--u)null!=l[u]&&-1!=="n?".indexOf(l[u].t)&&(M>=l[u].v.length-1?(M-=l[u].v.length,l[u].v=O.substr(M+1,l[u].v.length)):M<0?l[u].v="":(l[u].v=O.substr(0,M+1),M=-1),l[u].t="t",D=u);M>=0&&D<l.length&&(l[D].v=O.substr(0,M+1)+l[D].v)}else if(T!==l.length&&-1===O.indexOf("E")){for(M=O.indexOf(".")-1,u=T;u>=0;--u)if(null!=l[u]&&-1!=="n?".indexOf(l[u].t)){for(i=l[u].v.indexOf(".")>-1&&u===T?l[u].v.indexOf(".")-1:l[u].v.length-1,E=l[u].v.substr(i+1);i>=0;--i)M>=0&&("0"===l[u].v.charAt(i)||"#"===l[u].v.charAt(i))&&(E=O.charAt(M--)+E);l[u].v=E,l[u].t="t",D=u}for(M>=0&&D<l.length&&(l[D].v=O.substr(0,M+1)+l[D].v),M=O.indexOf(".")+1,u=T;u<l.length;++u)if(null!=l[u]&&(-1!=="n?(".indexOf(l[u].t)||u===T)){for(i=l[u].v.indexOf(".")>-1&&u===T?l[u].v.indexOf(".")+1:0,E=l[u].v.substr(0,i);i<l[u].v.length;++i)M<O.length&&(E+=O.charAt(M++));l[u].v=E,l[u].t="t",D=u}}}for(u=0;u<l.length;++u)null!=l[u]&&"n?".indexOf(l[u].t)>-1&&(S=s>1&&t<0&&u>0&&"-"===l[u-1].v?-t:t,l[u].v=w(l[u].t,l[u].v,S),l[u].t="t");var P="";for(u=0;u!==l.length;++u)null!=l[u]&&(P+=l[u].v);return P}e.is_date=A,e._eval=C;var S=/\[[=<>]/,O=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function E(e,t){if(null==t)return!1;var a=parseFloat(t[2]);switch(t[1]){case"=":if(e==a)return!0;break;case">":if(e>a)return!0;break;case"<":if(e<a)return!0;break;case"<>":if(e!=a)return!0;break;case">=":if(e>=a)return!0;break;case"<=":if(e<=a)return!0}return!1}function T(e,t,a){null==a&&(a={});var s="";switch(typeof e){case"string":s="m/d/yy"==e&&a.dateNF?a.dateNF:e;break;case"number":s=14==e&&a.dateNF?a.dateNF:(null!=a.table?a.table:d)[e]}if(o(s,0))return y(t,a);t instanceof Date&&(t=_(t,a.date1904));var r=function(e,t){var a=M(e),s=a.length,r=a[s-1].indexOf("@");if(s<4&&r>-1&&--s,a.length>4)throw new Error("cannot find right format for |"+a.join("|")+"|");if("number"!=typeof t)return[4,4===a.length||r>-1?a[a.length-1]:"@"];switch(a.length){case 1:a=r>-1?["General","General","General",a[0]]:[a[0],a[0],a[0],"@"];break;case 2:a=r>-1?[a[0],a[0],a[0],a[1]]:[a[0],a[1],a[0],"@"];break;case 3:a=r>-1?[a[0],a[1],a[0],a[2]]:[a[0],a[1],a[2],"@"]}var i=t>0?a[0]:t<0?a[1]:a[2];if(-1===a[0].indexOf("[")&&-1===a[1].indexOf("["))return[s,i];if(null!=a[0].match(S)||null!=a[1].match(S)){var n=a[0].match(O),l=a[1].match(O);return E(t,n)?[s,a[0]]:E(t,l)?[s,a[1]]:[s,a[null!=n&&null!=l?2:1]]}return[s,i]}(s,t);if(o(r[1]))return y(t,a);if(!0===t)t="TRUE";else if(!1===t)t="FALSE";else if(""===t||null==t)return"";return C(r[1],t,a,r[0])}function D(e,t){if("number"!=typeof t){t=+t||-1;for(var a=0;a<392;++a)if(null!=d[a]){if(d[a]==e){t=a;break}}else t<0&&(t=a);t<0&&(t=391)}return d[t]=e,t}e.load=D,e._table=d,e.get_table=function(){return d},e.load_table=function(e){for(var t=0;392!=t;++t)void 0!==e[t]&&D(e[t],t)},e.init_table=c,e.format=T}(s),"undefined"==typeof DO_NOT_EXPORT_SSF&&(e.exports=s)},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s);const i=function(e,t){for(var a=[],s=0;s<e;s++)a.push(t);return a},n={theme:{section:"Theme",type:"string",display:"select",label:"Theme",values:[{Traditional:"traditional"},{Looker:"looker"},{Contemporary:"contemporary"}],default:"traditional",order:1},layout:{section:"Theme",type:"string",display:"select",label:"Layout",values:[{Even:"fixed"},{Auto:"auto"}],default:"fixed",order:2},columnOrder:{},rowSubtotals:{section:"Table",type:"boolean",label:"Row Subtotals",display_size:"half",default:"false",order:1},colSubtotals:{section:"Table",type:"boolean",label:"Col Subtotals",display_size:"half",default:"false",order:2},spanRows:{section:"Table",type:"boolean",label:"Merge Dims",display_size:"half",default:"true",order:3},spanCols:{section:"Table",type:"boolean",label:"Merge Headers",display_size:"half",default:"true",order:4},subtotalDepth:{section:"Table",type:"number",label:"Sub Total Depth",default:1,order:5},sortColumnsBy:{section:"Table",type:"string",display:"select",label:"Sort Columns By",values:[{Pivots:"getSortByPivots"},{Measures:"getSortByMeasures"}],default:"getSortByPivots",order:6},useViewName:{section:"Table",type:"boolean",label:"Include View Name",default:"false",order:7},useHeadings:{section:"Table",type:"boolean",label:"Use Headings (non-pivots only)",default:"false",order:8},useShortName:{section:"Table",type:"boolean",label:"Use Short Name (from model)",default:"false",order:9},groupVarianceColumns:{section:"Table",type:"boolean",label:"Group Variance Columns After Pivots",default:"false",order:10},indexColumn:{section:"Dimensions",type:"boolean",label:"Use Last Field Only",default:"false",order:0}};class l extends class{constructor({table:e,name:t,view:a,label:s,is_numeric:r,value_format:i="",heading:n="",short_name:l="",unit:o=""}){this.table=e,this.name=t,this.view=a,this.label=s,this.is_numeric=r,this.value_format=i,this.heading=n,this.short_name=l,this.unit=o}}{constructor({table:e,name:t,view:a,label:s,is_numeric:r,value_format:i="",heading:n="",short_name:l="",unit:o=""}){super({table:e,name:t,view:a,label:s,is_numeric:r,value_format:i,heading:n,short_name:l,unit:o}),this.type="dimension",this.align="left",void 0!==this.table.config["hide|"+this.name]&&(this.table.config["hide|"+this.name]?this.hide=!0:this.hide=!1)}}class o extends l{constructor({table:e,name:t,view:a,label:s,is_numeric:r,is_table_calculation:i,calculation_type:n,can_pivot:l,is_turtle:o=!1,heading:h="",short_name:u="",unit:c="",value_format:d=""}){super({table:e,name:t,view:a,label:s,is_numeric:r,value_format:d,heading:h,short_name:u,unit:c}),this.type="measure",this.is_table_calculation=i,this.calculation_type=n,this.can_pivot=l,this.is_turtle=o,this.align="right",void 0!==this.table.config["style|"+this.name]&&("hide"===this.table.config["style|"+this.name]?this.hide=!0:this.hide=!1)}}class h{constructor({keys:e,values:t,types:a=[]}){if(e.length===t.length){this.keys=e,this.values=t,this.types=[];for(var s=[],r=[],i=0;i<e.length;i++)this.types[i]=void 0!==a[i]?a[i]:"line_item","line_item"===this.types[i]?(s.push(this.values[i]),r.push(this.values[i])):"subtotal"===this.types[i]&&r.push(this.values[i]);this.min_for_display=Math.min(r),this.max_for_display=Math.max(r),this.min=Math.min(s),this.max=Math.max(s),this.sum=s.reduce((e,t)=>e+t,0),this.count=s.length,this.avg=s.length>0?this.sum/s.length:null}else console.log("Could not construct series, arrays were of different length.")}}class u{constructor({column:e,row:t,sort_value:a,series:s}){this.column=e,this.row=t,this.sort_value=a,this.series=new h(s)}to_string(){for(var e="",t=0;t<this.series.keys.length;t++){e+=this.series.keys[t]+":",e+=(""===this.column.parent.value_format?this.series.values[t].toString():r.a.format(this.column.parent.value_format,this.series.values[t]))+" "}return e}}class c{constructor({column:e,is_numeric:t,series:a}){this.column=e,this.is_numeric=t,this.series=new h(a)}}class d{constructor(e){this.id="",this.type=e,this.sort=[],this.data={}}}class f{constructor(e,t,a){this.id=e,this.table=t,this.parent=a,this.field={},this.idx=0,this.pos=0,this.levels=[],this.pivot_key="",this.unit=a.unit||"",this.hide=a.hide||!1,this.variance_type="",this.pivoted=!1,this.subtotal=!1,this.super=!1,this.series=null,this.sort_by_measure_values=[],this.sort_by_pivot_values=[]}getLabel(e){switch(e=Object.assign({hasPivots:!1,level:0},e),this.variance_type){case"absolute":var t="Var #";break;case"percentage":t="Var %";break;default:t=this.table.useShortName&&this.parent.short_name||this.parent.label}var a="label|"+this.parent.name;if(void 0!==this.table.config[a]&&this.table.config[a]!==this.parent.label&&(t=this.table.config[a]?this.table.config[a]:t),this.table.useViewName&&(t=[this.parent.view,t].join(" ")),this.table.has_pivots)"getSortByPivots"===this.table.sortColsBy?e.level<this.levels.length&&(t=this.levels[e.level]):e.level>=1&&(t=this.levels[e.level-1]);else if(this.table.useHeadings&&0===e.level){a="heading|"+this.parent.name;t=void 0!==this.table.config[a]&&this.table.config[a]?this.table.config[a]:this.parent.heading}return t}updateSortByMeasures(e){1==this.sort_by_measure_values[0]&&(this.pivoted||this.subtotal||(this.sort_by_measure_values=[1,e]))}getSortByMeasures(){return this.sort_by_measure_values}getSortByPivots(){return this.sort_by_pivot_values}}exports.LookerDataTable=class{constructor(e,t,a){this.config=a,this.columns=[],this.dimensions=[],this.measures=[],this.data=[],this.pivot_fields=[],this.pivot_values=[],this.variances=[],this.column_series=[],this.rowspan_values={},this.useIndexColumn=a.indexColumn||!1,this.useHeadings=a.useHeadings||!1,this.useShortName=a.useShortName||!1,this.useViewName=a.useViewName||!1,this.addRowSubtotals=a.rowSubtotals||!1,this.addSubtotalDepth=a.subtotalDepth||this.dimensions.length-1,this.spanRows=a.spanRows,this.spanCols=a.spanCols,this.sortColsBy=a.sortColumnsBy||"getSortByPivots",this.has_totals=!1,this.has_subtotals=!1,this.has_row_totals=t.has_row_totals||!1,this.has_pivots=!1,this.has_supers=!1;this.checkPivotsAndSupermeasures(t),this.checkVarianceCalculations(),this.addDimensions(t,0),this.addMeasures(t,0),this.buildIndexColumn(t),this.buildRows(e),this.addColumnSeries(),this.buildTotals(t),this.updateRowSpanValues(),this.config.rowSubtotals&&this.addSubTotals(a.subtotalDepth),this.config.colSubtotals&&2==this.pivot_fields.length&&this.addColumnSubTotals(),this.addVarianceColumns(),this.sortColumns(),this.applyFormatting(),this.validateConfig()}static getCoreConfigOptions(){return n}getConfigOptions(){for(var e=n,t=0;t<this.dimensions.length;t++)e["label|"+this.dimensions[t].name]={section:"Dimensions",type:"string",label:this.dimensions[t].label,default:this.dimensions[t].label,order:10*t+1},e["heading|"+this.dimensions[t].name]={section:"Dimensions",type:"string",label:"Heading",default:"",order:10*t+2},e["hide|"+this.dimensions[t].name]={section:"Dimensions",type:"boolean",label:"Hide",display_size:"third",order:10*t+3};for(t=0;t<this.measures.length;t++){e["label|"+this.measures[t].name]={section:"Measures",type:"string",label:this.measures[t].label_short||this.measures[t].label,default:this.measures[t].label_short||this.measures[t].label,order:100+10*t+1},e["heading|"+this.measures[t].name]={section:"Measures",type:"string",label:"Heading for "+(this.measures[t].label_short||this.measures[t].label),default:"",order:100+10*t+2},e["style|"+this.measures[t].name]={section:"Measures",type:"string",label:"Style",display:"select",values:[{Normal:"normal"},{"Black/Red":"black_red"},{Hide:"hide"}],order:100+10*t+3};var a=[];if(this.measures[t].can_pivot){for(var s=[],r=0;r<this.pivot_fields.length;r++){if(0===r||this.config.colSubtotals)(l={})["By "+this.pivot_fields[r]]=this.pivot_fields[r],s.push(l)}a=a.concat(s)}for(var i=0;i<this.measures.length;i++){var l,o=this.measures[t].can_pivot===this.measures[i].can_pivot||this.has_row_totals&&!this.measures[i].is_table_calculation;if(t!=i&&o)(l={})["vs. "+this.measures[i].label]=this.measures[i].name,a.push(l)}a.unshift({"(none)":"no_variance"}),e["comparison|"+this.measures[t].name]={section:"Measures",type:"string",label:"Comparison",display:"select",values:a,order:100+10*t+5},e["switch|"+this.measures[t].name]={section:"Measures",type:"boolean",label:"Switch",display_size:"third",order:100+10*t+6},e["var_num|"+this.measures[t].name]={section:"Measures",type:"boolean",label:"Var #",display_size:"third",order:100+10*t+7},e["var_pct|"+this.measures[t].name]={section:"Measures",type:"boolean",label:"Var %",display_size:"third",order:100+10*t+8}}return e}checkPivotsAndSupermeasures(e){for(var t=0;t<e.fields.pivots.length;t++){var a=e.fields.pivots[t].name;this.pivot_fields.push(a)}void 0!==e.pivots&&(this.pivot_values=e.pivots,this.has_pivots=!0),void 0!==e.fields.supermeasure_like&&(this.has_supers=!0)}checkVarianceCalculations(){var e=this.config;Object.keys(e).forEach(t=>{if(t.startsWith("comparison")){var a=t.split("|")[1];if(this.pivot_fields.includes(e[t]))var s="by_pivot";else s="vs_measure";if(void 0!==e["switch|"+a])if(e["switch|"+a])var r=!0;else r=!1;this.variances.push({baseline:a,comparison:e[t],type:s,reverse:r})}})}applyVisToolsTags(e,t){if(void 0!==e.tags)for(var a=0;a<e.tags.length;a++){var s=e.tags[a].split(":");"vis-tools"===s[0]&&("heading"===s[1]?t.heading=s[2]:"short_name"===s[1]?t.short_name=s[2]:"unit"===s[1]&&(t.unit=s[2]))}}addDimensions(e,t){for(var a=0;a<e.fields.dimension_like.length;a++){var s=new l({table:this,name:e.fields.dimension_like[a].name,type:"dimension",view:e.fields.dimension_like[a].view_label||"",label:e.fields.dimension_like[a].label_short||e.fields.dimension_like[a].label,is_numeric:e.fields.dimension_like[a].is_numeric});this.applyVisToolsTags(e.fields.dimension_like[a],s),this.dimensions.push(s);var r=new f(s.name,this,s);r.idx=t,r.levels=i(e.fields.pivots.length,""),r.field=e.fields.dimension_like[a],r.pivoted=!1,r.super=!1,r.sort_by_measure_values=[0,t,...i(this.pivot_fields.length,0)],r.sort_by_pivot_values=[0,...i(this.pivot_fields.length,0),t],void 0!==this.config["style|"+s.name]&&("hide"===this.config["style|"+s.name]?this.hide=!0:this.hide=!1),this.columns.push(r),t+=10}}addMeasures(e,t){for(var a=this.config,s=0;s<e.fields.measure_like.length;s++){var r=new o({table:this,name:e.fields.measure_like[s].name,view:e.fields.measure_like[s].view_label||"",label:e.fields.measure_like[s].label_short||e.fields.measure_like[s].label,is_numeric:e.fields.measure_like[s].is_numeric,value_format:e.fields.measure_like[s].value_format||"",is_table_calculation:void 0!==e.fields.measure_like[s].is_table_calculation,can_pivot:!0,is_turtle:e.fields.measure_like[s].is_turtle,calculation_type:e.fields.measure_like[s].type});this.applyVisToolsTags(e.fields.measure_like[s],r),this.measures.push(r)}if(this.has_pivots)for(var n=0;n<this.pivot_values.length;n++)for(s=0;s<this.measures.length;s++){if("$$$_row_total_$$$"!=this.pivot_values[n].key||"$$$_row_total_$$$"==this.pivot_values[n].key&&0==this.measures[s].is_table_calculation){for(var l=this.pivot_values[n].key,h=l+"."+this.measures[s].name,u=[],c=[],d=0;d<e.fields.pivots.length;d++){var v=e.fields.pivots[d].name;u.push(this.pivot_values[n].data[v]),c.push(this.pivot_values[n].sort_values[v])}var m=this.measures[s];(g=new f(h,this,m)).idx=t,g.levels=u,g.field=e.fields.measure_like[s],g.pivoted=!0,g.super=!1,g.pivot_key=l,"$$$_row_total_$$$"!==this.pivot_values[n].key?(g.sort_by_measure_values=[1,s,...c],g.sort_by_pivot_values=[1,...c,t]):(g.sort_by_measure_values=[2,s,...i(this.pivot_fields.length,0)],g.sort_by_pivot_values=[2,...i(this.pivot_fields.length,0),t]),this.columns.push(g),t+=10}}else for(s=0;s<this.measures.length;s++){(g=new f(this.measures[s].name,this,this.measures[s])).idx=t;try{void 0!==a.columnOrder[g.id]?g.pos=a.columnOrder[g.id]:g.pos=t}catch{g.pos=t}g.field=e.fields.measure_like[s],g.pivoted=!1,g.super=!1,g.sort_by_measure_values=[1,g.pos],g.sort_by_pivot_values=[1,g.pos],this.columns.push(g),t+=10}if(void 0!==e.fields.supermeasure_like)for(var p=0;p<e.fields.supermeasure_like.length;p++){var g,_=new o({table:this,name:e.fields.supermeasure_like[p].name,view:"",label:e.fields.supermeasure_like[p].label,is_numeric:e.fields.supermeasure_like[p].is_numeric,value_format:e.fields.supermeasure_like[p].value_format,is_table_calculation:e.fields.supermeasure_like[p].is_table_calculation,calculation_type:e.fields.supermeasure_like[p].type,can_pivot:!1});this.applyVisToolsTags(e.fields.supermeasure_like[p],_),this.measures.push(_),(g=new f(_.name,this,_)).idx=t,g.levels=i(e.fields.pivots.length,""),g.field=e.fields.supermeasure_like[p],g.pivoted=!1,g.super=!0,g.sort_by_measure_values=[2,t,...i(this.pivot_fields.length,1)],g.sort_by_pivot_values=[2,...i(this.pivot_fields.length,1),t],this.columns.push(g),t+=10}}buildIndexColumn(e){var t=new f("$$$_index_$$$",this,this.dimensions[this.dimensions.length-1]);t.levels=i(e.fields.pivots.length,""),t.sort_by_measure_values=[-1,0,...i(this.pivot_fields.length,0)],t.sort_by_pivot_values=[-1,...i(this.pivot_fields.length,0),0],this.columns.push(t)}buildRows(e){for(var t=0;t<e.length;t++){for(var a=new d("line_item"),s=0;s<this.columns.length;s++){var r=this.columns[s];if(r.pivoted?a.data[r.id]=e[t][r.parent.name][r.pivot_key]:a.data[r.id]=e[t][r.id],void 0!==a.data[r.id]&&(void 0===a.data[r.id].cell_style&&(a.data[r.id].cell_style=[]),null===a.data[r.id].value&&(a.data[r.id].rendered=""),r.parent.is_turtle)){var i=new u({column:r,row:a,sort_value:a.data[r.id].sort_value,series:{keys:a.data[r.id]._parsed.keys,values:a.data[r.id]._parsed.values}});a.data[r.id].value=i,a.data[r.id].rendered=i.to_string()}}for(var n=[],l=0;l<this.dimensions.length;l++)n.push(e[t][this.dimensions[l].name].value);a.id=n.join("|");var o=this.dimensions[this.dimensions.length-1].name,h=e[t][o].value;a.data.$$$_index_$$$={value:h,cell_style:["indent"]},a.sort=[0,0,t],this.data.push(a)}}applyFormatting(){for(var e=this.config,t=0;t<this.columns.length;t++){var a=this.columns[t];if(void 0!==e["style|"+a.id]&&"black_red"==e["style|"+a.id])for(var s=0;s<this.data.length;s++){var r=this.data[s];r.data[a.id].value<0&&r.data[a.id].cell_style.push("red")}}}getColumnById(e){var t={};return this.columns.forEach(a=>{e===a.id&&(t=a)}),t}getMeasureByName(e){var t={};return this.measures.forEach(a=>{e===a.name&&(t=a)}),t}updateRowSpanValues(){var e={};for(s=0;s<this.dimensions.length;s++)e[this.dimensions[s].name]=1;for(var t=this.data.length-1;t>=0;t--){var a=this.data[t];if("line_item"===a.type){this.rowspan_values[a.id]={};for(var s=0;s<this.dimensions.length;s++){var r=this.dimensions[s].name,i=this.data[t].data[r].value;if(t>0)var n=this.data[t-1].data[r].value;if(!(t>0&&i==n)){for(var l=s;l<this.dimensions.length;l++){var o=this.dimensions[l].name;this.rowspan_values[a.id][o]=e[o],e[o]=1}break}this.rowspan_values[a.id][this.dimensions[s].name]=-1,e[r]+=1}}else for(s=0;s<this.dimensions.length;s++)e[this.dimensions[s].name]=1}}sortData(){this.data.sort((e,t)=>{for(var a=e.sort.length,s=0;s<a;s++){if(e.sort[s]>t.sort[s])return 1;if(e.sort[s]<t.sort[s])return-1}return-1}),this.updateRowSpanValues()}sortColumns(){this.columns.sort((e,t)=>{for(var a=this.sortColsBy,s=e[a]().length,r=0;r<s;r++){if(e[a]()[r]>t[a]()[r])return 1;if(e[a]()[r]<t[a]()[r])return-1}return-1})}addSubTotals(){for(var e=this.addSubtotalDepth,t=[],a=[],s=0;s<this.data.length;s++){var i=this.data[s];if("total"!==i.type){for(var n=[],l=0;l<e;l++){var o=this.dimensions[l].name;n.push(i.data[o].value)}n.join("|")!==a.join("|")&&(t.push(n),a=n),i.sort=[0,t.length-1,s]}}for(var h=this.dimensions[0].name,u=0;u<this.dimensions.length;u++)if(!this.dimensions[u].hide){h=this.dimensions[u].name;break}for(var c=0;c<t.length;c++){var f=new d("subtotal");for(u=0;u<this.columns.length;u++){var v=this.columns[u];if(f.data[v.id]={cell_style:["total"]},"$$$_index_$$$"===v.id||v.id===h){var m=t[c].join(" | ");f.data[v.id].value=m}if("measure"==v.parent.type){if(v.pivoted)var p=[v.pivot_key,v.parent.name].join(".");else p=v.id;for(var g=0,_=0,b="",y=0;y<this.data.length;y++){var $=this.data[y];if("line_item"==$.type&&$.sort[1]==c){var k=$.data[p].value;Number.isFinite(k)&&(g+=k,_++)}}"average"===v.parent.calculation_type&&_>0&&(g/=_),g&&(b=""===v.parent.value_format?g.toString():r.a.format(v.parent.value_format,g)),"string"===v.parent.calculation_type&&(g="",b="");var w={value:g,rendered:b,cell_style:["total"]};f.data[p]=w}}f.sort=[0,c,9999],this.data.push(f)}this.sortData(),this.has_subtotals=!0}addColumnSubTotals(){for(var e="",t={},a=[],s=[],i=this.pivot_fields[0],n=0;n<this.pivot_values.length;n++){var l=this.pivot_values[n].data[i];null!==l&&s.push(l)}s=[...new Set(s)];for(n=0;n<s.length;n++)for(var o=s[n],h=[0,""],u=null,c=0;c<this.measures.length;c++)if(this.measures[c].can_pivot){for(var d=this.measures[c].name,v={parent:this.measures[c],field:d,pivot:o,measure_idx:c,pivot_idx:n,columns:[],id:["$$$_subtotal_$$$",o,d].join("."),after:""},m=0;m<this.columns.length;m++){(g=this.columns[m]).pivoted&&g.levels[0]==o&&(g.parent.name==d&&v.columns.push(g.id),g.levels[0]==o&&m>h[0]&&(h=[m,g.id]))}o!=e&&(t[o]=h[1],u=null),v.after=u||t[o],e=o,u=v.id,a.push(v)}for(var p=0;p<a.length;p++){var g,_=a[p],b=this.measures[_.measure_idx];(g=new f(_.id,this,b)).levels=[_.pivot,"Subtotal"],g.field={name:_.field},g.sort_by_measure_values=[1,_.measure_idx,...g.levels];var y=[...g.levels];"string"==typeof y[y.length-1]?y[y.length-1]="ZZZZ":y[y.length-1]=9999,g.sort_by_pivot_values=[1,...y,1e4+p],g.pivoted=!0,g.subtotal=!0,g.pivot_key=[_.pivot,"$$$_subtotal_$$$"].join("|"),this.columns.push(g)}this.sortColumns();for(var $=0;$<this.data.length;$++){var k=this.data[$];for(p=0;p<a.length;p++){_=a[p];for(var w=0,M=0;M<_.columns.length;M++){var x=_.columns[M];w+=k.data[x].value}k.data[_.id]={value:w,rendered:""===g.value_format?w.toString():r.a.format(g.parent.value_format,w),align:"right"},["total","subtotal"].includes(k.type)&&(k.data[_.id].cell_style=["total"])}}return a}calculateVariance(e,t,a,s,i){for(var n=0;n<this.data.length;n++){var l=this.data[n],o=l.data[s.id].value,h=l.data[i.id].value;if("absolute"===a)var u={value:o-h,rendered:""===e?(o-h).toString():r.a.format(e,o-h),cell_style:[]};else{var c=(o-h)/Math.abs(h);if(isFinite(c))u={value:c,rendered:r.a.format("#0.00%",c),cell_style:[]};else var u={value:null,rendered:"∞",cell_style:[]}}"total"!=l.type&&"subtotal"!=l.type||u.cell_style.push("total"),u.value<0&&u.cell_style.push("red"),l.data[t]=u}}createVarianceColumn(e){var t=this.config,a=["$$$_variance_$$$",e.calc,e.variance.baseline,e.variance.comparison].join("|"),s=this.getColumnById(e.variance.baseline),r=this.getColumnById(e.variance.comparison),i=new f(a,this,s.parent);"absolute"===e.calc?(i.variance_type="absolute",i.idx=s.idx+1,i.pos=s.pos+1,i.sort_by_measure_values=s.sort_by_measure_values.concat(1),i.sort_by_pivot_values=s.sort_by_pivot_values.concat(1),i.hide=!t["var_num|"+s.parent.name]):(i.variance_type="percentage",i.idx=s.idx+2,i.pos=s.pos+2,i.sort_by_measure_values=s.sort_by_measure_values.concat(2),i.sort_by_pivot_values=s.sort_by_pivot_values.concat(2),i.unit="%",i.hide=!t["var_pct|"+s.parent.name]),s.sort_by_measure_values.length<i.sort_by_measure_values.length&&s.sort_by_measure_values.push(0),s.sort_by_pivot_values.length<i.sort_by_pivot_values.length&&s.sort_by_pivot_values.push(0),void 0!==t.columnOrder[i.id]&&(i.pos=t.columnOrder[i.id]),i.field={name:a},i.pivoted=s.pivoted,i.super=s.super,i.pivot_key="",i.levels=s.levels,t.groupVarianceColumns&&("getSortByPivots"===t.sortColumnsBy&&(i.sort_by_pivot_values[0]=1.5),1===s.levels.length?i.levels=["Variance"]:i.levels=["Variance",s.levels[1]]),this.columns.push(i),e.variance.reverse?this.calculateVariance(s.parent.value_format,a,e.calc,r,s):this.calculateVariance(s.parent.value_format,a,e.calc,s,r)}addVarianceColumns(){var e=[],t=["absolute","percent"];Object.keys(this.variances).forEach(a=>{var s=this.variances[a];if("no_variance"!==s.comparison)if("vs_measure"===s.type)this.has_pivots?this.pivot_values.forEach(a=>{a.is_total||t.forEach(t=>{e.push({calc:t,variance:{baseline:[a.key,s.baseline].join("."),comparison:[a.key,s.comparison].join("."),reverse:s.reverse,type:s.type}})})}):t.forEach(t=>{e.push({variance:s,calc:t})});else if("by_pivot"===s.type)if(1===this.pivot_fields.length||this.pivot_fields[1]===s.comparison)this.pivot_values.slice(1).forEach((a,r)=>{t.forEach(t=>{a.is_total||e.push({calc:t,variance:{baseline:[a.key,s.baseline].join("."),comparison:[this.pivot_values[r].key,s.baseline].join("."),reverse:s.reverse,type:s.type}})})});else{var r=[];this.pivot_values.forEach(e=>{if(!e.is_total){var t=e.data[this.pivot_fields[0]];r.includes(t)||r.push(t)}}),r.slice(1).forEach((a,i)=>{t.forEach(t=>{e.push({calc:t,variance:{baseline:["$$$_subtotal_$$$",a,s.baseline].join("."),comparison:["$$$_subtotal_$$$",r[i],s.baseline].join("."),reverse:s.reverse,type:s.type}})})})}}),e.forEach(e=>{this.createVarianceColumn(e)})}addColumnSeries(){this.columns.forEach(e=>{var t=[],a=[],s=[];this.data.forEach(r=>{t.push(r.id),a.push(r.data[e.id].value),s.push(r.type)});var r=new c({column:e,is_numeric:e.parent.is_numeric,series:{keys:t,values:a,types:s}});e.series=r,this.column_series.push(r)})}buildTotals(e){if(void 0!==e.totals_data){if(void 0!==e.truncated)var t=!0;else t=!1;for(var a=e.totals_data,s=this.dimensions[0].name,i=0;i<this.dimensions.length;i++)if(!this.dimensions[i].hide){s=this.dimensions[i].name;break}for(var n=new d("total"),l=new d("line_item"),o=0;o<this.columns.length;o++){var h=this.columns[o],u=null;if(n.data[h.id]={value:"",cell_style:["total"]},l.data[h.id]={value:"",cell_style:[]},"measure"==h.parent.type){if(1==h.pivoted)var c=a[h.parent.name][h.pivot_key];else c=a[h.id];if(void 0===c.rendered&&void 0!==c.html&&(c.rendered=this.getRenderedFromHtml(c)),t&&(["sum","count_distinct","count"].includes(h.parent.calculation_type)?u=c.value-h.series.series.sum:"average"===h.parent.calculation_type&&(u=(c.value+h.series.series.avg)/2)),c.cell_style=["total"],n.data[h.id]=c,t&&u){var f=""===h.parent.value_format?u.toString():r.a.format(h.parent.value_format,u);l.data[h.id]={value:u,rendered:f}}}}n.data.$$$_index_$$$.value="TOTAL",n.data[s].value="TOTAL",n.sort=[1,0,0],t&&(l.data.$$$_index_$$$.value="Others",l.data[s].value="Others",l.sort=[1,-1,-1]),this.data.push(n),t&&this.data.push(l),this.has_totals=!0,this.sortData()}}getRenderedFromHtml(e){var t=new DOMParser;if(""!==e.html)try{a=(a=t.parseFromString(e.html,"text/html")).getElementsByTagName("a")[0].innerText}catch(t){var a=e.html}else a=e.value;return a}getLevels(){var e=this.pivot_fields.length+1;return this.useHeadings&&!this.has_pivots&&e++,i(e,0)}setColSpans(e){for(var t=this.config,a=[],s=[],r=[],n=e.length-1;n>=0;n--){var l=e.length-1-n;if("getSortByPivots"===this.sortColsBy?a[l]=[...e[n].levels,e[n].field.name]:a[l]=[e[n].field.name,...e[n].levels],this.useHeadings&&!this.has_pivots){var o=e[n].parent.heading,h="heading|"+e[n].parent.name;void 0!==t[h]&&(o=t[h]?t[h]:o),a[l].unshift(o)}s[n]=i(a[l].length,1)}if(this.spanCols){r=i(a[0].length,1);for(var u=0;u<a.length;u++)for(var c=a[u].length-1,d=0;d<c;d++){var f=a[u][d];if(u<a.length-1)var v=a[u+1][d];if(!(u<a.length-1&&f==v)){for(var m=d;m<c;m++)s[u][m]=r[m],r[m]=1;break}s[u][d]=-1,r[d]+=1}if("getSortByPivots"===this.sortColsBy)var p=this.pivot_fields.length+1;else p=0;for(u=a.length-1;u>=0;u--){f=a[u][p];if(u>0)var g=a[u-1][p];u>0&&f==g?(s[u][p]=-1,r[p]+=1):(s[u][p]=r[p],r[p]=1)}s.reverse()}for(n=0;n<e.length;n++)e[n].colspans=s[n];return e}getColumnsToDisplay(e){this.config;if(this.useIndexColumn)var t=this.columns.filter(e=>"measure"==e.parent.type||"$$$_index_$$$"==e.id).filter(e=>!e.hide);else t=this.columns.filter(e=>"$$$_index_$$$"!==e.id).filter(e=>!e.hide);return t=this.setColSpans(t).filter(t=>t.colspans[e]>0)}getRow(e){if(this.useIndexColumn)var t=this.columns.filter(e=>"measure"==e.parent.type||"$$$_index_$$$"==e.id).filter(e=>!e.hide);else t=this.columns.filter(e=>"$$$_index_$$$"!==e.id).filter(e=>!e.hide);if(!this.useIndexColumn&&this.spanRows){for(var a=0;a<t.length;a++)t[a].rowspan=1,"line_item"===e.type&&this.rowspan_values[e.id][t[a].id]>0&&(t[a].rowspan=this.rowspan_values[e.id][t[a].id]);"line_item"===e.type&&(t=t.filter(t=>"measure"==t.parent.type||this.rowspan_values[e.id][t.id]>0))}return t}moveColumns(e,t,a){var s=this.config;if(e!=t){for(var r=t-e,i=s.columnOrder,n=0;n<this.columns.length;n++){var l=this.columns[n];"measure"!=l.parent.type||l.super||(l.pos>=e&&l.pos<e+10?l.pos+=r:l.pos>=t&&l.pos<e?l.pos+=10:l.pos>=e+10&&l.pos<t+10&&(l.pos-=10),i[l.id]=l.pos)}a(i)}}validateConfig(){["traditional","looker","contemporary"].includes(this.config.theme)||(this.config.theme="traditional"),["fixed","auto"].includes(this.config.layout)||(this.config.layout="fixed")}getSimpleJson(){var e=[];return this.data.forEach(t=>{if("line_item"===t.type){var a={};this.columns.forEach(e=>{a[e.id]=t.data[e.id].value}),e.push(a)}}),e}}}]);
//# sourceMappingURL=looker_data_table.js.map